<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ziew + Kaplay Demo</title>
  <style>
    * { margin: 0; padding: 0; }
    body {
      background: #000;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
  </style>
</head>
<body>
  <script src="https://unpkg.com/kaplay@3001/dist/kaplay.js"></script>
  <script>
    // Initialize Kaplay
    kaplay({
      width: 640,
      height: 480,
      background: [20, 20, 40],
    })

    // Game constants
    const SPEED = 240
    const JUMP_FORCE = 520
    const GRAVITY = 1400

    // Main game scene
    scene("game", () => {
      setGravity(GRAVITY)

      // Ground
      add([
        rect(width(), 48),
        pos(0, height() - 48),
        color(34, 139, 34),
        area(),
        body({ isStatic: true }),
        "ground"
      ])

      // Platforms
      const platforms = [
        { x: 100, y: 350, w: 120 },
        { x: 300, y: 280, w: 100 },
        { x: 500, y: 350, w: 120 },
        { x: 200, y: 180, w: 100 },
        { x: 450, y: 120, w: 120 },
      ]

      platforms.forEach(p => {
        add([
          rect(p.w, 20),
          pos(p.x, p.y),
          color(80, 80, 100),
          area(),
          body({ isStatic: true }),
          "platform"
        ])
      })

      // Player (a colorful square)
      const player = add([
        rect(32, 32),
        pos(80, height() - 100),
        color(50, 200, 255),
        area(),
        body(),
        anchor("center"),
        "player"
      ])

      // Snappy arcade-style controls
      onUpdate(() => {
        // Horizontal movement - direct velocity control for responsiveness
        let moveX = 0
        if (isKeyDown("left") || isKeyDown("a")) moveX -= 1
        if (isKeyDown("right") || isKeyDown("d")) moveX += 1

        // Set horizontal velocity directly (snappy, no acceleration)
        player.vel.x = moveX * SPEED
      })

      const jump = () => {
        if (player.isGrounded()) {
          player.jump(JUMP_FORCE)
        }
      }
      onKeyPress("space", jump)
      onKeyPress("up", jump)
      onKeyPress("w", jump)

      // Score
      let score = 0
      const scoreLabel = add([
        text("Score: 0", { size: 24 }),
        pos(12, 12),
        fixed(),
      ])

      // Spawn collectibles (coins as circles)
      function spawnCoin() {
        add([
          circle(12),
          pos(rand(50, width() - 50), rand(50, height() - 150)),
          color(255, 215, 0),
          area(),
          anchor("center"),
          "coin"
        ])
      }

      // Initial coins
      for (let i = 0; i < 8; i++) spawnCoin()

      // Collect coins
      player.onCollide("coin", (coin) => {
        destroy(coin)
        score += 10
        scoreLabel.text = "Score: " + score
        spawnCoin()

        // Win condition
        if (score >= 100) {
          go("win", score)
        }
      })

      // Enemies (red squares that move) - spread across the level
      const enemySpawns = [
        { x: 150, y: 320 },   // Lower left
        { x: 400, y: 250 },   // Middle
        { x: 550, y: 90 },    // Upper right
      ]

      enemySpawns.forEach(spawn => {
        add([
          rect(24, 24),
          pos(spawn.x, spawn.y),
          color(255, 80, 80),
          area(),
          anchor("center"),
          "enemy",
          { dir: choose([-1, 1]), speed: rand(50, 90) }
        ])
      })

      // Move enemies
      onUpdate("enemy", (e) => {
        e.move(e.dir * e.speed, 0)
        if (e.pos.x < 30 || e.pos.x > width() - 30) {
          e.dir *= -1
        }
      })

      // Player hits enemy = game over
      player.onCollide("enemy", () => {
        go("gameover", score)
      })

      // Fall off screen = game over
      player.onUpdate(() => {
        if (player.pos.y > height() + 50) {
          go("gameover", score)
        }
      })

    })

    // Win scene
    scene("win", (finalScore) => {
      add([
        text("You Win!", { size: 64 }),
        pos(width() / 2, height() / 2 - 50),
        anchor("center"),
        color(255, 215, 0),
      ])

      add([
        text("Final Score: " + finalScore, { size: 32 }),
        pos(width() / 2, height() / 2 + 30),
        anchor("center"),
      ])

      add([
        text("Press SPACE to play again", { size: 20 }),
        pos(width() / 2, height() / 2 + 100),
        anchor("center"),
        color(150, 150, 150),
      ])

      onKeyPress("space", () => go("game"))
    })

    // Game over scene
    scene("gameover", (finalScore) => {
      add([
        text("Game Over", { size: 64 }),
        pos(width() / 2, height() / 2 - 50),
        anchor("center"),
        color(255, 80, 80),
      ])

      add([
        text("Score: " + finalScore, { size: 32 }),
        pos(width() / 2, height() / 2 + 30),
        anchor("center"),
      ])

      add([
        text("Press SPACE to try again", { size: 20 }),
        pos(width() / 2, height() / 2 + 100),
        anchor("center"),
        color(150, 150, 150),
      ])

      onKeyPress("space", () => go("game"))
    })

    // Start game
    go("game")
  </script>
</body>
</html>
